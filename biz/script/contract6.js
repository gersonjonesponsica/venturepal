function checkDuration(e){var a=e,t=addDays(a=a.replace(/-/g,"/"),2),n=setInterval(function(){var e=(new Date).getTime(),a=t-e,s=Math.floor(a/864e5),o=Math.floor(a%864e5/36e5),i=Math.floor(a%36e5/6e4),r=Math.floor(a%6e4/1e3);document.getElementById("demo").innerHTML=s+"d "+o+"h "+i+"m "+r+"s ",a<0&&(clearInterval(n),document.getElementById("demo").innerHTML="EXPIRED")},1e3)}function addDays(e,a){var t=new Date(e);return t.setDate(t.getDate()+a),t}function getMsmeDetails(){var e=[],a=$("#msme_id").val();e.push({name:"msme_id",value:a}),e.push({name:"action",value:"Get MSME by id"}),$.ajax({type:"POST",url:"controller/MsmeController.php",data:e,success:function(e){json=JSON.parse(jQuery.trim(e)),console.log(json.remaining_neededCap);var a=0,t=0,n=+json.msme_minInvestment,s=+json.msme_maxInvestment,o=+json.remaining_neededCap;a=o>=s?s:0==o?s:o,o<=100?(t=100,a=o):t=n,$("#amount-3").val(t),$("#amount").html(void 0!=t?"<span>&#8369;</span> "+numberWithCommas(t):t),$("#amount-2").html(void 0!=t?"<span>&#8369;</span> "+numberWithCommas(t):t),$("#slider-1").slider({min:t,max:a,step:50,slide:function(e,a){amount=a.value,changeValue(amount)}})}})}function viewMsme(){var e=[],a=$("#msme_id").val();e.push({name:"msme_id",value:a}),e.push({name:"action",value:"Get MSME by id"}),$.ajax({type:"POST",url:"controller/MsmeController.php",data:e,success:function(e){loadMsmeSmall(jQuery.trim(e)),$("#viewMsmeModal").modal({show:!0})}})}function loadMsmeSmall(e){var a=JSON.parse(e),t="";t+='<div class="col-sm-12 col-lg-12 col-md-12 m-t-30">',t+='<div class="card hovercard3 h-250 m-b-30">',t+='<div class="portfolio-item graphic-design ">',t+='<div class="he-wrap tpl6 ">',t+='<img class="center-bg h-150 m-fit " id="member1" src="img/business-cover2.png" class="img-responsive" alt="">',t+='<div class="he-view">',t+='<div class="bg a0" data-animate="fadeIn">',t+='<h3 class="a1 no-border" data-animate="fadeInDown">'+a.msme_name+"</h3>",t+=' <a data-toggle="tooltip" target="_blank" title="View Portfolio" data-rel="prettyPhoto" href="msme-portfolio?id='+a.msme_id+'" class="dmbutton a2" data-animate="fadeInUp"><i class="ion-edit ion-size-15"></i> Check Portfolio</a>',t+=" </div>\x3c!-- he bg --\x3e",t+="</div>\x3c!-- he view --\x3e",t+="</div>\x3c!-- he wrap --\x3e",t+="</div>\x3c!-- end col-12 --\x3e",t+='<div class="logo-box3">',t+='<img class="rounded-circle center-div" src="../../venturepal/bizsh.admin/Entrep/'+a.msme_logo+'" alt="Card image cap">',t+="</div>",t+='<div class="container-fluid m-t-20">',t+='<div class="row">',t+='<div class="col-2"></div>',t+='<div class="col-8">',t+='<a class="minmax">Raised '+(null!=a.percent_raised?numberWithCommas(a.percent_raised):0)+" %, <span>&#8369;</span> "+(null!=a.total_raised?numberWithCommas(a.total_raised):0)+"</a>",t+="</div>",t+='<div class="col-lg-2"></div>',t+="</div>",t+="</div>",t+='<div class="info" >',t+='<div class="title">'+a.msme_name+"</div>",t+="</div>",t+="</div>",t+="</div>",$("#viewMsmeMod").html(t)}function changeValue(e){$("#amount").html("<span>&#8369;</span> "+(void 0!=e?numberWithCommas(e):e)),$("#amount-2").html("<span>&#8369;</span> "+(void 0!=e?numberWithCommas(e):e)),$("#amount-3").val(e)}function checkInvestorContract(){var e=[],a=$("#msme_id").val(),t=$("#accountid").val();e.push({name:"v_id",value:t}),e.push({name:"msme_id",value:a}),e.push({name:"action",value:"Check investor contract"}),$.ajax({type:"POST",url:"controller/ContractController.php",data:e,success:function(e){if(json=JSON.parse(jQuery.trim(e)),console.log(json),$(".taba").attr("hidden",!0),!1===json)$(".contract_step a:first-child").addClass("nav-active"),$(".contract_step a").andSelf().next().addClass("disabledAnchor"),$("#row_stepone").fadeIn().removeAttr("hidden");else if(0==json.status){$(".bat").removeClass("nav-active"),$(".contract_step a:nth-child(2)").addClass("nav-active"),$(".contract_step a:first-child").addClass("disabledAnchor"),$(".contract_step a:last-child").addClass("disabledAnchor");var a=json.contract_date;$("#duration_").val(),checkDuration(a),$(".taba").attr("hidden",!0),$("#row_steptwo").fadeIn().removeAttr("hidden")}else 2==json.status?($(".bat").removeClass("nav-active"),$(".contract_step a:nth-child(3)").addClass("nav-active"),$(".contract_step a:first-child").addClass("disabledAnchor"),$(".contract_step a:nth-child(2)").addClass("disabledAnchor"),$(".taba").attr("hidden",!0),$("#row_stepthree").fadeIn().removeAttr("hidden")):1==json.status&&($(".bat").removeClass("nav-active"),$(".contract_step a:nth-child(3)").addClass("nav-active"),$(".contract_step a:first-child").addClass("disabledAnchor"),$(".contract_step a:nth-child(2)").addClass("disabledAnchor"),$(".taba").attr("hidden",!0),$("#row_stepthree").fadeIn().removeAttr("hidden"),$("#result").text("Your investment application was successfully invested"))}})}function genPDF(){$("#loadthis").addClass("loader-show"),generatePDF();var e=[],a=$("#msme_id").val(),t=$("#accountid").val(),n=$("#amount-3").val();e.push({name:"v_id",value:t}),e.push({name:"amount",value:n}),e.push({name:"msme_id",value:a}),e.push({name:"action",value:"Upload Contract"}),$.ajax({type:"POST",url:"controller/ContractController.php",data:e,success:function(e){console.log(jQuery.trim(e)),json=JSON.parse(jQuery.trim(e)),checkInvestorContract(),notification(t,a,1),$("#loadthis").removeClass("loader-show")}})}function getContractDetails(){var e=[],a=$("#msme_id").val(),t=$("#accountid").val();e.push({name:"v_id",value:t}),e.push({name:"msme_id",value:a}),e.push({name:"action",value:"Get Contract Details"}),$.ajax({type:"POST",url:"controller/ContractController.php",data:e,success:function(e){console.log(jQuery.trim(e)),json=JSON.parse(jQuery.trim(e)),console.log(json),$("#loadthis").removeClass("loader-show")}})}function generatePDF(){var e=new jsPDF;e.text(80,30,"Contract of Agreement"),e.setFontSize(12),e.text(20,40,"Contract Number: _______  Contract Date: __________ Contract Validity:__________"),e.fromHTML($("#content").get(0),20,45,{width:180,elementHandlers:{"#content":function(e,a){return!0}}}),e.setFontSize(10),e.text(20,230,"_____________________________"),e.text(17,236,"Venturer name & Signaturer date signed"),e.text(120,230,"________________________________"),e.text(116,236,"Entrepreneur name & Signature date signed"),e.save("VenturePal-Contract.pdf")}$(function(){$("#msme_id").val(),$("#accountid").val();getMsmeDetails(),checkInvestorContract()}),$(".contract").on("click",function(){$("#contract").click()}),$("#contract").on("change",function(){a=$(this)[0].files,0!=a.length&&($(".contract").html(a[0].name),"application/pdf"==a[0].type?$("#uploaded_file_contract").html('<img width="100" height="100" src="../../venturepal/bizsh.admin/images/PDFLogo.png"/>'):$("#uploaded_file_contract").html('<img width="100" height="100" src="'+window.URL.createObjectURL(a[0])+'"/>'),console.log(a[0].type),$(".contract ").removeClass("file-error"),$(".contract_ span").attr("hidden",!0))}),$(".investment").on("click",function(){$("#investment").click()}),$("#investment").on("change",function(){a=$(this)[0].files,0!=a.length&&($(".investment").html(a[0].name),"application/pdf"==a[0].type?$("#uploaded_file_investment").html('<img width="100" height="100" src="../../bizsh.admin/images/PDFLogo.png"/>'):$("#uploaded_file_investment").html('<img width="100" height="100" src="'+window.URL.createObjectURL(a[0])+'"/>'),console.log(a[0].type),$(".investment ").removeClass("file-error"),$(".investment_ span").attr("hidden",!0))}),$("#btn_upload_inve").click(function(){0==$("#investment")[0].files.length&&($(".investment").after('<span style="color: #E54444"> Please enter your </span>'),$(".investment ").addClass("file-error")),0==$("#contract")[0].files.length&&($(".contract").after('<span style="color: #E54444"> Please enter your </span>'),$(".contract ").addClass("file-error")),0!=$("#contract")[0].files.length&&0!=$("#investment")[0].files.length&&$("#invesmentForm").submit()}),$("#contractForm").submit(function(e){data=new FormData(this);var a=$("#msme_id").val(),t=$("#accountid").val();data.append("action","Upload Contract with sign"),data.append("msme_id",a),data.append("investor_id",t),$.ajax({url:"controller/ContractController.php",type:"POST",data:data,cache:!1,processData:!1,contentType:!1,success:function(e){console.log(jQuery.trim(e)),checkInvestorContract();var a=$("#msme_id").val(),t=$("#accountid").val();notification(t,a,2)}}),e.preventDefault()}),$("#invesmentForm").submit(function(e){data=new FormData(this);var a=$("#msme_id").val(),t=$("#accountid").val();data.append("action","Upload proof of investment"),data.append("msme_id",a),data.append("investor_id",t),$.ajax({url:"controller/ContractController.php",type:"POST",data:data,cache:!1,processData:!1,contentType:!1,success:function(e){console.log(jQuery.trim(e)),$("#contractForm").submit()}}),e.preventDefault()});