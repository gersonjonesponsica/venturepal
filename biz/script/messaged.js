var a,b,c,d,height=0,pageLocation=location.pathname.substring(location.pathname.lastIndexOf("/")+1),title="",isNoMessage=!1,loader='<div id="loadthis" class="loader-show-small"></div>',offset=0;function getUserConvo(e){"send"!=e&&$("#userContainer").html(loader);var s=$("#usertype").val(),a=0;a=1==s?$("#accountid").val():$("#msme_id").val();var t=getToid(),o=[];o.push({name:"from_id",value:a}),o.push({name:"usertype",value:s}),o.push({name:"to_id",value:t}),o.push({name:"action",value:"Get all user convo"}),$.ajax({type:"POST",url:"controller/MessageController.php",data:o,success:function(e){json=JSON.parse(jQuery.trim(e)),console.log(json);var a="";if(json.length>0){a+='<h5 class="text-center" style=" color: #ACAAAE;">Conversation</h5>';for(i in json){b=json[i];var o="";o=0==i?"border-top: 1px solid #d6d8d8;":"",1==s?b.msmeId==t?a+='<div style="border-bottom: 1px solid #d6d8d8; '+o+'" class="row side-chat-user user-active p-5" data-id='+b.msmeId+' data-file="'+b.name+'" onclick="showMessage(this)">':a+='<div style="border-bottom: 1px solid #d6d8d8; '+o+'" class="row side-chat-user p-5" data-id='+b.msmeId+" data-file="+b.name+' onclick="showMessage(this)">':b.investorId==t?a+='<div style="border-bottom: 1px solid #d6d8d8; '+o+'" class="row side-chat-user user-active p-5" data-id='+b.investorId+" data-file="+b.name+' onclick="showMessage(this)">':a+='<div style="border-bottom: 1px solid #d6d8d8; '+o+'" class="row side-chat-user p-5" data-id='+b.investorId+" data-file="+b.name+' onclick="showMessage(this)">',a+='<div class="col-lg-2">',a+=2==s?'<img class="img-circle-50 b-2-color" src="../../bizsh.admin/Investor/'+b.logo+'" alt="Profile image example" >':'<img class="img-circle-50 b-2-color" src="../../bizsh.admin/Entrep/'+b.logo+'" alt="Profile image example" >',a+="</div>",a+='<div class="col-lg-10" style="padding-left: 20px">',a+='<h6 class="m-t-10" id="name'+t+'">'+b.name+"</h6>",a+='<h6 class="chat-date m-t-5" id="last">'+b.timem+" </h6>",a+="</div>",a+="</div>"}}else a+='<h5 class="text-center" style="color:#ACAAAE">No Conversation yet..</h5>';getChoosenConvo("send"),setTimeout(function(){$("#userContainer").html(a)},500)}})}function getEntrepMSME3(){var e=[],s=$("#msme_id").val(),a=$("#accountid").val();e.push({name:"entrep_id",value:a}),e.push({name:"action",value:"Get Entrep MSME"}),console.log(a),$.ajax({type:"POST",url:"controller/MsmeController.php",data:e,success:function(e){var a=JSON.parse(jQuery.trim(e)),t="";if(console.log(a),a.length>0)for(i in a)b=a[i],t+='<a href="javascript:;">',t+='<li class="desc-nav" style="font-size: 13px" onclick="changeMsme(this)" data-id='+b.msme_id+' "><img src="../../bizsh.admin/Entrep/'+b.msme_logo+'" height="25" width="25" /> '+b.msme_name+"</li>",t+="</a>",b.msme_id==s&&$("#choosenMsme").html('<img src="../../bizsh.admin/Entrep/'+b.msme_logo+'" height="25" width="25"/> '+b.msme_name);else t+='<a href="javascript:;">',t+='<li class="desc-nav" style="font-size: 13px; color: #ACAAAE ">No Msme yet</li>',t+="</a>";setTimeout(function(){$("#msmeAcc").html(t)},400)}})}function changeMsme(e){var s=$(e).attr("data-id"),a=($("#msme_id").val(s),getToid());a=$("#to_id").val(a),a=getToid();$("#msme_id").val();window.history.pushState({url:""+pageLocation},"Pagina 1",pageLocation+"?profile="+s+"&to_id="+a),getEntrepMSME3(),getUserConvo(),getChoosenConvo()}function getChoosenConvo(e){"send"!=e&&$("#messageBoard").html(loader);var s=$("#usertype").val(),a=0;a=1==s?$("#accountid").val():$("#msme_id").val();var t=getToid(),o=[];o.push({name:"from_id",value:a}),o.push({name:"usertype",value:s}),o.push({name:"to_id",value:t}),o.push({name:"limit",value:offset+=8}),o.push({name:"action",value:"Get choosen convo"}),$.ajax({type:"POST",url:"controller/MessageController.php",data:o,success:function(e){json=JSON.parse(jQuery.trim(e));var a,t="";if(json.length>0)for(i in json)a=json[i],1==s?2==a.messageType?(t+='<div class="row mao justify-content-md-center m-t-10">',t+='<div class="col-lg-2">',t+="</div>",t+='<div class="col-lg-8">',t+='<div class="row pull-right">',t+='<div class="arrow_box_right">',t+='<h5 class="chat-style ">'+a.message+"</h5>",t+='<h6 class="pull-right chat-date m-t-5 ">'+a.month.substring(0,3)+" "+a.timem+"</h6>",t+="</div>",t+="</div>",t+="</div>",t+='<div class="col-lg-1 m-l-20">',t+='<div class="container">',t+='<img class="pull-right img-circle-60 b-2-color" src="../../bizsh.admin/Investor/'+a.name+'" alt="Profile image example" >',t+="</div>",t+="</div>",t+="</div>"):(t+='<div class="row mao m-t-10">',t+='<div class="col-lg-1 m-r-20">',t+='<div class="container">',t+='<img class="img-circle-60 b-2-color" src="../../bizsh.admin/Entrep/'+a.name+'" alt="Profile image example" >',t+="</div>",t+="</div>",t+='<div class="col-lg-8">',t+='<div class="row">',t+='<div class="arrow_box_left">',t+='<h5 class="chat-style">'+a.message+"</h5>",t+='<h6 class="chat-date m-t-5">'+a.month.substring(0,3)+" "+a.timem+"</h6>",t+="</div>",t+="</div>",t+='<div class="row">',t+="</div>",t+="</div>",t+='<div class="col-lg-2">',t+="</div>",t+="</div>"):1==a.messageType?(t+='<div class="row mao justify-content-md-center m-t-10">',t+='<div class="col-lg-2">',t+="</div>",t+='<div class="col-lg-8">',t+='<div class="row pull-right">',t+='<div class="arrow_box_right">',t+='<h5 class="chat-style ">'+a.message+"</h5>",t+='<h6 class="pull-right chat-date m-t-5">'+a.month.substring(0,3)+" "+a.timem+"</h6>",t+="</div>",t+="</div>",t+="</div>",t+='<div class="col-lg-1 m-l-20">',t+='<div class="container">',t+='<img class="pull-right img-circle-60 b-2-color" src="../../bizsh.admin/Entrep/'+a.name+'" alt="Profile image example" >',t+="</div>",t+="</div>",t+="</div>"):(t+='<div class="row mao m-t-10">',t+='<div class="col-lg-1 m-r-20">',t+='<div class="container">',t+='<img class="img-circle-60 b-2-color" src="../../bizsh.admin/Investor/'+a.name+'" alt="Profile image example" >',t+="</div>",t+="</div>",t+='<div class="col-lg-8">',t+='<div class="row">',t+='<div class="arrow_box_left">',t+='<h5 class="chat-style">'+a.message+"</h5>",t+='<h6 class="chat-date m-t-5">'+a.month.substring(0,3)+" "+a.timem+"</h6>",t+="</div>",t+="</div>",t+='<div class="row">',t+="</div>",t+="</div>",t+='<div class="col-lg-2">',t+="</div>",t+="</div>");else t+="",t+='<h4 class="center-text-in-div" style="color: #ACAAAE">No Message <i class="ion-chatbox-working"></i></h4>',t+="";t+='<div class="row">',t+='<h6 id="typing" class=" m-r-100 typing m-t-5"></h6>',t+="</div>",setTimeout(function(){var e=$("#usertype").val(),s=0;s=1==e?$("#accountid").val():$("#msme_id").val();var a=getToid(),i=[];i.push({name:"from_id",value:s}),i.push({name:"usertype",value:e}),i.push({name:"to_id",value:a}),i.push({name:"action",value:"Get name current convo"}),$.ajax({type:"POST",url:"controller/MessageController.php",data:i,success:function(s){json=JSON.parse(jQuery.trim(s));var a=1==e?'<div class="img-center-in-div"><img class="img-circle-50 center-img" src="../../bizsh.admin/Entrep/'+json.photo+'" alt="Profile image example" ><a href="" style="color: #21b08a"><h5 class="text-center">'+json.name+"</h5></a></div>":'<div class="img-center-in-div"><img class="img-circle-50" src="../../bizsh.admin/Investor/'+json.photo+'" alt="Profile image example" ><h5 class="text-center">'+json.name+"</h5></div>";$("#ctitle").html(a),$("#messageBoard").html(t)}})},500),height=getHeightScroll(),$("#messageBoard").animate({scrollTop:height+200},700)}})}function getHeightScroll(){return $("#messageBoard").prop("scrollHeight")}function showMessage(e){var s=$(e).attr("data-id"),a=$("#usertype").val();$(e).attr("data-file");$(".side-chat-user").removeClass("user-active"),$(e).addClass("user-active");$("#to_id").val(s);var i=$("#msme_id").val();1==a?window.history.pushState({url:""+pageLocation},"Pagina 1",pageLocation+"?to_id="+s):window.history.pushState({url:""+pageLocation},"Pagina 1",pageLocation+"?profile="+i+"&to_id="+s),getChoosenConvo("send")}function getToid(){return $("#to_id").val()}$(function(){2==$("#usertype").val()?getEntrepMSME3():$("#msmeAccount").attr("hidden",!0),getUserConvo()}),$("#btnSend").click(function(){if(""==(i=$("#message").val()).trim())return!1;var e,s=$("#usertype").val();e=1==s?$("#accountid").val():$("#msme_id").val();var a=getToid(),i=$("#message").val(),t=0;t=1==s?2:1;var o=[];o.push({name:"message",value:i}),o.push({name:"from_id",value:e}),o.push({name:"messageType",value:t}),o.push({name:"to_id",value:a}),o.push({name:"action",value:"Send Message all"}),$.ajax({type:"POST",url:"controller/MessageController.php",data:o,success:function(e){$("#messageForm")[0].reset(),getChoosenConvo("send"),getUserConvo("send"),send("send")}})});